<div class="banner">
    {if="$isOneA==1"}
    <img class="bg_color" src="/static/img/pic1jia.png" alt="100M流量红包免费发 流量福利大放送">
    {else}
    <img class="bg_color" src="/static/img/pic2.png" alt="100M流量红包免费发 流量福利大放送">
    {/if}
</div>
<div class="btn-box bg_color p_bottom_2">
    <a id="share_btn">免费发红包</a>
    <p class="color-dark-red t-center">免费发红包，自己也可以抢哦！</p>
</div>
<div class="btn-box t-center bg_color pb15">
    <a href="rule.html" id="rules" class="color-dark-red ">活动规则</a>
</div>
<div>
    <img class="border_wave" src="/static/img/wave.png">
</div>
<h2>流量合作伙伴</h2>
<div class="new-logos clearfix">
    <img src="/static/img/logo9.png"/><img src="/static/img/logo10.png"/>
</div>
<!-- <div class="logos clearfix">
    <img src="/static/img/logo5.png"/><img src="/static/img/logo6.png"/><img src="/static/img/logo7.png"/><img src="/static/img/logo8.png"/>
</div> -->
<div class="code-box" style="margin:2em auto 3em;white-space:normal;clear:both;">
    <img class="QRCode2" src="/static/img/code2.png" alt="二维码">
</div>
<p class="code-tip">长按指纹识别二维码，关注欧朋流量宝</p>
<div class="cover" id="cover" style="display: none;"></div>
<div class="share-guide" id="guide" style="display: none;">
    <img src="/static/img/share-guid.png" alt="点击右上角... 然后点击分享"/>
</div>
<div id="toast" class="none">
    发送成功
</div>
{if condition="$status==1"}
<script>

    window.onload = function () {
        var btn = document.getElementById("share_btn"),
                cover = document.getElementById("cover"),
                guide = document.getElementById("guide"),
                toast = document.getElementById("toast"),
                redirect_url = "";
        //点击发红包按钮
        btn.addEventListener("click", packHandler, false);
        //关闭浮层
        cover.addEventListener("touchend", function (e) {
            e.preventDefault();
            cover.style.cssText = "display:none";
            guide.style.cssText = "display:none";
        }, false);
        //阻止cover浮层上的滑动
        cover.addEventListener("touchmove", function (e) {
            e.preventDefault();
        }, false);
        function closeGuide(){
            cover.style.cssText = "display:none";//关闭分享引导层
            guide.style.cssText = "display:none";//关闭分享引导层
        }
        function packHandler() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
                        var responseObj = JSON.parse(xhr.responseText);
                        var code = responseObj.code;
                        if (code == 200) {//成功，可以发红包
                            // alert(responseObj.redirect_url);
                            redirect_url = responseObj.redirect_url;
                            var bodyHeight = window.innerHeight+document.body.scrollTop;
                            cover.style.cssText="display:block;height:"+bodyHeight+"px";//打开分享引导层
                            guide.style.cssText = "display:block";//打开分享引导层
                            //设置分享自定义事件
                            wx.ready(function () {
                                /*发送给朋友*/
                                wx.onMenuShareAppMessage({
                                    title: '我发了流量红包，快来抢啊！', // 分享标题
                                    desc: '这是{$nickName}通过欧朋流量宝发的100M流量红包，点击直接抢！', // 分享描述
                                    link: redirect_url, // 分享链接
                                    imgUrl: '{$host}/images/share-pic.png', // 分享图标
                                    success: function () {
                                        closeGuide();
                                    },
                                    cancel: function () {
                                        closeGuide();
                                    }
                                });
                                /*分享到朋友圈*/
                                wx.onMenuShareTimeline({
                                    title: '{$nickName}发了100M流量红包，快来抢啊！', // 分享标题
                                    imgUrl: '{$host}/images/share-pic.png', // 分享图标
                                    link: redirect_url, // 分享链接
                                    success: function () {
                                        closeGuide();
                                    },
                                    cancel: function () {
                                        closeGuide();
                                    }
                                });
                            });
                        } else {//种种原因，不能发红包
                            alert(responseObj.message);
                            redirect_url = responseObj.redirect_url;
                            location.href=redirect_url;
                            return;
                        }
                    }
                }
            }
            xhr.open("get", "/getSysPacket", false);
            xhr.send(null);
        }
    };
</script>
{else}
<script>
    window.onload = function () {
        var btn = document.getElementById("share_btn"),
                cover = document.getElementById("cover"),
                guide = document.getElementById("guide"),
                toast = document.getElementById("toast"),
                imgSrc = document.getElementById("wx_pic").src,
                redirect_url = "";
        //点击发红包按钮
        btn.addEventListener("click", openGuide, false);
        //关闭浮层
        cover.addEventListener("touchend", function (e) {
            e.preventDefault();
            cover.style.cssText = "display:none";
            guide.style.cssText = "display:none";
        }, false);
        //阻止cover浮层上的滑动
        cover.addEventListener("touchmove", function (e) {
            e.preventDefault();
        }, false);
        function openGuide() {
            var bodyHeight = window.innerHeight+document.body.scrollTop;
            cover.style.cssText="display:block;height:"+bodyHeight+"px";//打开分享引导层
            guide.style.cssText = "display:block";//打开分享引导层
        }
        function closeGuide(){
            cover.style.cssText = "display:none";//关闭分享引导层
            guide.style.cssText = "display:none";//关闭分享引导层
        }

//设置分享自定义事件
        wx.ready(function () {
            /*发送给朋友*/
            wx.onMenuShareAppMessage({
                title: '我发了流量红包，快来抢啊！', // 分享标题
                desc: '这是{$nickName}通过欧朋流量宝发的100M流量红包，点击直接抢！', // 分享描述
                imgUrl: imgSrc, // 分享图标
                link: '{$packet_url}',
                success: function () {
                    closeGuide();
                },
                cancel: function () {
                    closeGuide();
                }
            });
            /*分享到朋友圈*/
            wx.onMenuShareTimeline({
                title: '{$nickName}发了100M流量红包，快来抢啊！', // 分享标题
                imgUrl: imgSrc, // 分享图标
                link: '{$packet_url}',
                success: function () {
                    closeGuide();
                },
                cancel: function () {
                    closeGuide();
                }
            });
        });
    };
</script>
{/if}
